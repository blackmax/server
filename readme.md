## Описание архитектуры

- `/models` - дирректория моделей из базы данных
- `/services` - сервисы, где можно писать логику и использовать в командах
- `/websocket_services/commands` - команды выполняемые для юзера

## Принцип работы

При возникновении события берется обработчик из файла `websocket_services/socket_bus.js`

В каждое событие передается контекст состоящий из основных элементов

`db` - содержит модели `sequilize` хранятся в папке `/models`

`services` - содержит сервисы из соответствующей папки

`data` - содержит данные из запроса пользователя

`socket` - содержит сокет по которому ведется взаимодействие с пользователем

`logger` - логер 

`action` - текущее событие

## События

Любое зарегистрированное событие принимает объект
```js
{
    db,
    services,
    data,
    socket,
    logger,
    action,
}
```

Пример команды
```js
module.exports = async ({services, socket, data}) => {}
```

или

```js
module.exports = async function (ctx) {}
```

Документация
=

*add_currency* - добавление валюты пользователю

Необходимые данные:
```

type: @string - тип валюты,
amount: @double - сколько валюты,
token: @string - токен авторизации

```

-----

*adventure_level_finished* - был закончен уровень

Необходимые данные:

```
stars: @numeric - количество звёзд
time: @numeric - время за которое был пройден уровень
level_number: @numeric - номер уровня
level_type: @any - тип уровня
token: @string - идентификатор авторизации пользователя
```

-----

*buy_car* - покупка машины

Необходимые данные:

```
car_id: @numeric - ид машины
token: @string - идентификатор авторизации пользователя
```

------

*car_skin_changed* - изменен скин машины

Необходимые данные:

```
car_id: @numeric - ид машины
skin_id: @numeric - ид скина
token: @string - идентификатор авторизации пользователя
```

----

*car_upgrade* - апгрейд машины

 Необходимые данные:
 
 ```
 upgrade_type: @any - тип апгрейда
 car_id: @numeric - ид машины
 token: @string - идентификатор авторизации пользователя
 ```
 
 -----
 
 *drop* - дроп из сундука
 
 ```
 work in process
 ```
 
 -----
 
 *icon_changed* - иконка изменена
 
 Необходимые данные:
 
 ```
token: @string - идентификатор авторизации пользователя
icon_id: @numeric - ид иконки
 ```
 -----
 
 *login_command* - логин юзера

------

*profile* - получение профиля юзера

Необходимые данные:

```
token: @string - идентификатор авторизации пользователя
```
 
------

*query_command* - получение списка данных для выбранной таблице

Необходимые данные:

```
model: @string - табилца из которой получают данные
```

------

*register_command* - регистрация

Необходимые данные:

```
token: @string - сгенерированный токен пользователя
```

------

*user_cars* - машины пользователя

Необходимые данные:

```
token: @string - токен авторизации
```